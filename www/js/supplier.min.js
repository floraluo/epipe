angular.module("starter.controller",[]).controller("SupplierCtrl",["$rootScope","$scope","$state","$ionicHistory",function($rootScope,$scope,$state,$ionicHistory){$rootScope.myGoBack=function(){"supplier.quotation"==$ionicHistory.viewHistory().backView.stateName&&($rootScope.$ionicGoBack(-2),window.location.reload()),$rootScope.$ionicGoBack(-1)}}]).controller("homeCtrl",["$scope","$state","$stateParams","$location","supplier",function($scope,$state,$stateParams,$location,supplier){var promise=supplier.getSupplierInfo();$scope.sale=function(){promise.then(function(data){data.login?$state.go("supplier.release"):($state.go("login"),window.location.reload())})}}]).controller("loginCtrl",["$scope","$state","$ionicBackdrop","$ionicLoading","supplier",function($scope,$state,$ionicBackdrop,$ionicLoading,supplier){var user=$scope.user={name:"",password:"",validPassword:!1};$scope.supplierLogin=function(myform){if(myform.$valid){$ionicBackdrop.retain(),$ionicLoading.show({template:"<ion-spinner icon='ios' class='spinner spinner-ios '></ion-spinner>",noBackdrop:!0});var promise=supplier.getSupplierInfo();promise.then(function(data){user.password==data.password?(alert("登录成功！"),$ionicBackdrop.release(),$ionicLoading.hide(),$state.go("supplier.release")):user.validPassword=!0}),console.log($scope.user)}},$scope.pathToRegis=function(){$state.go("register"),window.location.reload()}}]).controller("registerCtrl",["$scope","$state",function($scope,$state){$scope.userRegisInfo={email:"",tel:"",company:"",password:"",repassword:""},$scope.show_error=!1,$scope.supplierRegiste=function(myform){myform.$dirty&&($scope.show_error=!0,myform.$valid&&(alert("提交成功！"),console.log($scope.userRegisInfo),$state.go("login"),window.location.reload()))}}]).controller("personalCtrl",["$scope","$http","supplier",function($scope,$http,supplier){var promise=supplier.getSupplierInfo();promise.then(function(data){$scope.supplier=data},function(data){})}]).controller("releaseCtrl",["$scope","$timeout",function($scope,$timeout){$scope.keywords=["","",""],$scope.addKeywords=function(){$timeout(function(){$scope.keywords.push("")},10)},$scope.releaseKeywords=function(){console.log($scope.keywords)}}]).controller("orderListCtrl",["$scope","order","$state","$stateParams","$ionicPopup",function($scope,order,$state,$stateParams,$ionicPopup){$scope.order={canBeLoaded:!0,content:[]},$scope.amount=0;var promise=order.getOrder();promise.then(function(data){$scope.order.content=data},function(data){console.log(data)}),$scope.displayOrderList=function(){promise.then(function(data){$scope.order.content=data,$scope.$broadcast("scroll.refreshComplete")},function(data){console.log(data)})},$scope.loadMoreOrder=function(){$scope.amount<2?promise.then(function(data){$scope.amount++,$scope.order.content=$scope.order.content.concat(data),$scope.$broadcast("scroll.infiniteScrollComplete")},function(data){console.log(data)}):($scope.order.canBeLoaded=!1,$ionicPopup.alert({template:"没有更多数据了！"}))}}]).controller("quotationCtrl",["$scope","$http","$state","$stateParams","$ionicHistory","order",function($scope,$http,$state,$stateParams,$ionicHistory,order){$scope.show_error=!1,$http.get("../data/order"+$stateParams.orderId+".json").success(function(data){$scope.order=data}),$scope.productQuo={unitPrice:"",totalPrice:""},$scope.canlTotalPrice=function(orderNum){$scope.productQuo.unitPrice=parseInt($scope.productQuo.unitPrice)>0?$scope.productQuo.unitPrice:"",$scope.productQuo.totalPrice=$scope.productQuo.unitPrice*orderNum!=0?$scope.productQuo.unitPrice*orderNum:""},$scope.quotation=function(myform){myform.$dirty&&($scope.show_error=!0,myform.$valid&&(alert("提交成功！"),$state.go("supplier.orderDetail",{orderId:$stateParams.orderId})))}}]).controller("orderDetailCtrl",["$scope","$http","$state","$stateParams","$ionicHistory","$location","order","supplier",function($scope,$http,$state,$stateParams,$ionicHistory,$location,order,supplier){$http.get("../data/order"+$stateParams.orderId+".json").success(function(data){$scope.order=data});var promise=supplier.getSupplierInfo();promise.then(function(data){$scope.supplier=data},function(data){})}]).controller("LogisTrackCtrl",["$scope","$http","$stateParams",function($scope,$http,$stateParams){$http.get("../data/transit_step.json").success(function(data){$scope.transit=data}),$http.get("../data/order"+$stateParams.orderId+".json").success(function(data){$scope.thisOrder=data})}]).controller("tabsCtrl",function($scope,$rootScope,$state){$rootScope.$on("$ionicView.beforeEnter",function(){$rootScope.hideTabs=!1,"tabs.events-create"===$state.current.name&&($rootScope.hideTabs=!0)})}).controller("LogoutCtrl",["$scope","$ionicHistory","$state","supplier",function($scope,$ionicHistory,$state,supplier){var promise=supplier.getSupplierInfo();$scope.logout=function(){promise.then(function(data){data.login=!1,$state.go("home"),window.location.reload(),console.log($ionicHistory)})}}]),angular.module("starter.directive",[]).directive("supplierRelease",["$timeout",function($timeout){return{restrict:"E",link:function($scope,$element){}}}]).directive("repeat",[function(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ctrl){if(ctrl){var otherInput=element.inheritedData("$formController")[attrs.repeat],repeatValidator=function(value){var validity=value===otherInput.$viewValue;return ctrl.$setValidity("repeat",validity),validity?value:void 0};ctrl.$parsers.push(repeatValidator),ctrl.$formatters.push(repeatValidator),otherInput.$parsers.push(function(value){return ctrl.$setValidity("repeat",value===ctrl.$viewValue),value})}}}}]),angular.module("starter.service",[]).factory("supplier",["$q","$http",function($q,$http){function getSupplierInfo(){var def=$q.defer();return $http.get("../data/supplier.json").success(function(data){supplier.info=data,def.resolve(data)}).error(function(){def.reject("Failed to get supplier info")}),def.promise}var supplier={info:[],getSupplierInfo:getSupplierInfo};return supplier}]).factory("order",["$q","$http",function($q,$http){function getOrder(){var def=$q.defer();return $http.get("../data/order.json").success(function(data){order.info=data,def.resolve(data)}).error(function(){def.reject("Failed to get order info")}),def.promise}var order={info:[],getOrder:getOrder};return order}]);